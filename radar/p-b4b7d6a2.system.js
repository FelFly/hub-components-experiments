System.register(["./p-efd827df.system.js","./p-adc488b3.system.js","./p-8acf3331.system.js"],(function(e){"use strict";var t,r,n,i,u,a,s,o;return{setters:[function(e){t=e._;r=e.r;n=e.c;i=e.a},function(e){u=e.c;a=e.j;s=e.l},function(e){o=e.i}],execute:function(){e({a:v,b:l,d:h,g:d,q:f,r:y,s:m,u:g});function l(e,t){return c(e,t).then((function(r){var n=o(t);var i=r.url.match(/services\/(.*?)\/FeatureServer/);if(i[1]){return n+"/api/v3/events/"+e+"/"+i[1]+"/FeatureServer/0"}}))}function d(e,t){var r;var n=Object.assign({},t);if(e==="cancelled"){if(!t.orderByFields){n.orderByFields="EditDate DESC"}r="isCancelled=1 AND status<>'draft'"}else if(e==="draft"){if(!t.orderByFields){n.orderByFields="EditDate DESC"}var i=t.authentication;var u=i?i.username:null;r="Creator = '"+u+"' AND status = 'draft'"}else{if(!t.orderByFields){n.orderByFields=e==="upcoming"?"startDate ASC":"startDate DESC"}var a=e==="upcoming"?">":"<=";r="endDate"+a+"CURRENT_TIMESTAMP AND (isCancelled<>1 OR isCancelled IS NULL) AND status<>'draft'"}if(t.where){n.where=t.where+" AND "+r}else{n.where=r}return n}function c(e,r){return u(t({q:"typekeywords:hubEventsLayer AND orgid:"+e},r)).then((function(e){var t=e;if(t.results&&t.results.length>0){var r=void 0;if(t.results.length===1){r=t.results[0]}else if(t.results.length>1){var n=t.results.reduce((function(e,t){if(!t.typeKeywords.includes("View Service")){e.admin=t}else{if(t.access==="public"){e.public=t}else{e.org=t}}return e}),{});r=n.admin||n.org||n.public}return r}else{throw Error("No events service found. Events are likely not enabled.")}}))}function f(e){var u=i(e,["where","objectIds","relationParam","time","distance","units","outFields","geometry","geometryType","spatialRel","returnGeometry","maxAllowableOffset","geometryPrecision","inSR","outSR","gdbVersion","returnDistinctValues","returnIdsOnly","returnCountOnly","returnExtentOnly","orderByFields","groupByFieldsForStatistics","outStatistics","returnZ","returnM","multipatchOption","resultOffset","resultRecordCount","quantizationParameters","returnCentroid","resultType","historicMoment","returnTrueCurves","sqlFormat","returnExceededLimitFeatures","f"],{httpMethod:"GET",params:t({where:"1=1",outFields:"*"},e.params)});return r(n(e.url)+"/query",u)}function v(e){var u=n(e.url)+"/addFeatures";var a=i(e,["features","gdbVersion","returnEditMoment","rollbackOnFailure"],{params:t({},e.params)});return r(u,a)}function h(e){var u=n(e.url)+"/deleteFeatures";var a=i(e,["where","objectIds","gdbVersion","returnEditMoment","rollbackOnFailure"],{params:t({},e.params)});return r(u,a)}function m(e){var r=t({returnGeometry:true},e);return f(r).then((function(t){if(t.features.length<=0){return{data:[],included:[]}}if(r.authentication){return r.authentication.getToken(r.url).then((function(n){return p(t.features,r.url,e,n)}))}else{return p(t.features,r.url,e)}}))}function p(e,t,r,n){var i=[];var a=[];var s=[];var o=(new Date).getTime();var l="";e.forEach((function(e){var r=e.attributes;var u=e.geometry;var s=null;if(r.imageAttributes){var d=JSON.parse(r.imageAttributes);if(d.crop){s=t+"/"+r.OBJECTID+"/attachments/"+d.crop+"?v="+o;if(n){s+="&token="+n}}}a.push({id:r.OBJECTID,type:"events",imageUrl:s,attributes:r,geometry:u});var c=r.siteId;if(c!=null&&i.indexOf(c)===-1){i.push(c);l+=l.length>0?" OR id:":"id:";l+=c}}));if(i.length===0){return{included:s,data:a}}var d=r;d.q=l;return u(d).then((function(e){e.results.forEach((function(e){s.push({id:e.id,type:"sites",attributes:{id:e.id,url:e.url}})}));return{included:s,data:a}}))}function y(e){return a({id:e.groupId,authentication:e.authentication})}function g(e){return s({id:e.groupId,authentication:e.authentication})}}}}));