var __awaiter=this&&this.__awaiter||function(t,e,n,r){function a(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,i){function o(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r["throw"](t))}catch(e){i(e)}}function u(t){t.done?n(t.value):a(t.value).then(o,s)}u((r=r.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(t){return function(e){return u([t,e])}}function u(o){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,a&&(i=o[0]&2?a["return"]:o[0]?a["throw"]||((i=a["return"])&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;if(a=0,i)o=[o[0]&2,i.value];switch(o[0]){case 0:case 1:i=o;break;case 4:n.label++;return{value:o[1],done:false};case 5:n.label++;a=o[1];o=[0];continue;case 7:o=n.ops.pop();n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){n.label=o[1];break}if(o[0]===6&&n.label<i[1]){n.label=i[1];i=o;break}if(i&&n.label<i[2]){n.label=i[2];n.ops.push(o);break}if(i[2])n.ops.pop();n.trys.pop();continue}o=e.call(t,n)}catch(s){o=[6,s];a=0}finally{r=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};System.register(["./p-bda334d9.system.js","./p-c74e1ae1.system.js","./p-ad2aa800.system.js","./p-0f2b0e97.system.js","./p-635da667.system.js","./p-25515151.system.js","./p-90737b62.system.js","./p-723eb060.system.js","./p-420d31cf.system.js","./p-4587e83b.system.js","./p-69e00f75.system.js"],(function(t){"use strict";var e,n,r,a,i,o,s,u,c,l,d;return{setters:[function(t){e=t.r;n=t.c;r=t.h;a=t.g},function(){},function(){},function(){},function(){},function(){},function(){},function(t){i=t.U},function(){},function(t){o=t.g;s=t.d;u=t.b;c=t.c;l=t.e},function(t){d=t.r}],execute:function(){var p=':host{display:block}@media screen and (max-width: 530px){.gallery-card{width:calc((100% - (0 * 30px))/ 1)}}@media screen and (min-width: 530px) and (max-width: 975px){.gallery-card{width:calc((100% - (1 * 30px))/ 2)}}@media screen and (min-width: 975px) and (max-width: 1200px){.gallery-card{width:calc((100% - (2 * 30px))/ 3)}}@media screen and (min-width:1200px){.gallery-card{width:calc((100% - (3 * 30px))/ 4)}}.gallery-card{display:-ms-flexbox;display:flex;-ms-flex-flow:column;flex-flow:column;color:#4c4c4c;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-bottom:30px;-webkit-box-shadow:0 0 5px 0 rgba(76,76,76,.25);box-shadow:0 0 5px 0 rgba(76,76,76,.25);}.card-image{height:40px;background-image:url(https://idee.paris.fr/svg/preview-proposal-image.svg);background-size:cover;background-repeat:no-repeat;background-position:center center}.search-grid{display:grid;grid-template:".   search" auto\n    "filters results" auto /\n    12rem 3fr;padding:0 1rem 0 3rem}hub-suggest-input{grid-area:search}.filters{grid-area:filters}.search-results{grid-area:results;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-pack:justify;justify-content:space-between}.recent_heading{float:left;width:40%}.srch_bar{display:inline-block;text-align:right;width:60%}.headind_srch{padding:10px 29px 10px 20px;overflow:hidden;border-bottom:1px solid #c4c4c4}.recent_heading h4{color:#05728f;font-size:21px;margin:auto}.srch_bar input{border:1px solid #cdcdcd;border-width:0 0 1px 0;width:80%;padding:2px 0 4px 6px;background:none}.srch_bar .input-group-addon button{background:rgba(0, 0, 0, 0) none repeat scroll 0 0;border:medium none;padding:0;color:#707070;font-size:18px}.srch_bar .input-group-addon{margin:0 0 0 -27px}';var h=t("hub_discussion",function(){function t(t){e(this,t);this.allowReply=true;this.portalUrl="https://www.arcgis.com";this.authors={};this.searchOptions={};this.newResponse=n(this,"newResponse",7)}t.prototype.eventAddAnnotation=function(t){console.log("Event: eventAddAnnotation",t);this.addAnnotation(t.detail.annotation)};t.prototype.addAnnotation=function(t){this.updateAnnotations();this.newResponse.emit(t)};t.prototype.queryUpdated=function(){this.updateAnnotations()};t.prototype.targetUpdated=function(t){console.log("hub-discussion: Updated discussion target",t);this.updateAnnotations()};t.prototype.componentWillLoad=function(){var t=this;this.session=d();if(!!this.session){this.username=JSON.parse(this.session).username}if(this.target===null||this.target===undefined){this.target=""}else{this.searchOptions.target=this.target}return o(this.org).then((function(e){t.annotationsUrl=e+"/0";return t.updateAnnotations()}))};t.prototype.updateAnnotations=function(){var t=this;return this.getAnnotations().then((function(e){t.annotations=e.data;for(var n=0;n<e.included.length;n++){if(t.authors[e.included[n].id]===undefined){t.authors[e.included[n].id]=e.included[n].attributes}}}))};t.prototype.deleteAnnotation=function(t){var e=this;console.log("deleteAnnotations",t);s({url:this.annotationsUrl,objectIds:[t]}).then((function(t){console.log("deleteAnnotations",t);return e.updateAnnotations()}))};t.prototype.getAnnotations=function(){var t=["1=1"];if(!!this.query){t.push("description LIKE '%"+this.query+"%'")}if(!!this.target){t.push("target LIKE '"+this.target+"'")}return u({url:this.annotationsUrl,where:t.join(" AND ")})};t.prototype.searchChanged=function(t){this.query=t.target.value;return this.updateAnnotations()};t.prototype.getElementById=function(t){for(var e=0;e<this.el.childElementCount;e++){var n=this.el.children[e].getAttribute("id");if(n==t){return this.el.children[e]}}return null};t.prototype.removeAnnotation=function(t){return __awaiter(this,void 0,void 0,(function(){var e,n;return __generator(this,(function(r){switch(r.label){case 0:console.log("removeAnnotation",[t.target.id,t]);e=t.detail;return[4,s({url:this.annotationsUrl,objectIds:[e],authentication:i.deserialize(this.session)})];case 1:n=r.sent();console.debug("hub-discussion: removeAnnotation response",n);this.updateAnnotations();return[2]}}))}))};t.prototype.getAuthor=function(t){console.log("getAuthor 1",[t,this.authors[t]]);if(t.length===0){return this.authors[t]||c()}console.log("getAuthor 2",[t,l(this.authors[t])]);return l(this.authors[t])};t.prototype.formatDate=function(t){return new Date(t).toLocaleString()};t.prototype.discussionCard=function(t){return r("calcite-card",{class:"gallery-card",selectable:true},r("img",{class:"card-image",slot:"thumbnail"}),r("h3",{slot:"title"},r("img",{src:this.getAuthor(t.attributes.Creator).thumbnailUrl}),this.getAuthor(t.attributes.Creator).name),r("span",{slot:"subtitle"}),t.attributes.description,r("span",{slot:"footer-leading"},this.formatDate(t.attributes.created_at)))};t.prototype.renderGallery=function(){var t=this;var e=[];this.annotations.map((function(n){e.push(t.discussionCard(n))}));return r("div",{class:"search-results gallery-lg "},e)};t.prototype.renderList=function(){var t=this;var e=[];var n=this.getElementById("annotation-header");var a="Comments";if(n!==null){a=n.innerHTML}e.push(r("div",{class:"headind_srch"},r("div",{class:"recent_heading"},r("h4",{innerHTML:a})),r("div",{class:"srch_bar"},r("div",{class:"stylish-input-group"},r("input",{type:"text",class:"search-bar",placeholder:"Search",onChange:function(e){return t.searchChanged(e)}}),r("span",{class:"input-group-addon"},r("button",{type:"button"}," ",r("i",{class:"fa fa-search","aria-hidden":"true"})," "))))));e.push(r("div",{class:"discussion-list"},this.annotations.map((function(e){return r("discussion-entry",{annotationId:e.attributes.OBJECTID,authorImage:t.getAuthor(e.attributes.Creator).thumbnailUrl,authorName:t.getAuthor(e.attributes.Creator).name,description:e.attributes.description,publishedDate:t.formatDate(e.attributes.created_at),allowReply:t.allowReply&&e.attributes.Creator!==t.username,allowDelete:e.attributes.Creator===t.username,allowEdit:e.attributes.Creator===t.username})}))));if(!!this.username){e.push(r("discussion-input",{target:this.target,annotationsUrl:this.annotationsUrl}))}return e};t.prototype.render=function(){return this.renderList()};Object.defineProperty(t.prototype,"el",{get:function(){return a(this)},enumerable:true,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{query:["queryUpdated"],target:["targetUpdated"]}},enumerable:true,configurable:true});return t}());h.style=p}}}));