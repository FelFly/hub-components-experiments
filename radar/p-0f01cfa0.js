import{H as t,V as e}from"./p-ab9e545c.js";import{r as a,_ as n}from"./p-3a73ba05.js";import{d as r,c as s,e as u,f as i,h as o,i as c,k as m}from"./p-25b1b343.js";import{s as l}from"./p-fbebadbb.js";import{q as p,a as d,d as h,g as b,s as f}from"./p-51001fa3.js";function w(t){return t.outFields||(t.outFields=["OBJECTID","Creator","Editor","created_at","updated_at","description","source","status","target","dataset_id"]),(null==t.where||t.where.length<=0)&&(t.where="1=1"),t.where+=" AND parent_id IS NULL",console.log("hub-annotations: searchAnnotations: requestOptions",t),p(t).then((function(e){var a=[],n=[];e.features.forEach((function(t){var e=t.attributes,r=t.geometry,s={id:e.OBJECTID,type:"annotations",attributes:e};r&&(s.geometry=r),n.push(s),-1===a.indexOf(e.Creator)&&a.push(e.Creator)}));var s=a.filter((function(t){return""!==t})).map((function(e){return r({username:e,portal:t.portal,authentication:t.authentication}).catch((function(){return null}))}));return Promise.all(s).then((function(t){var e=[];return t.forEach((function(t){t&&e.push({id:t.username,type:"users",attributes:t})})),{included:e,data:n}}))}))}function y(t,e){return s(n({q:"typekeywords:hubAnnotationLayer AND orgid:"+t},e)).then((function(t){if(t.results&&t.results.length>0){var e=t.results[0].url;return e.replace(/^http:/gi,"https:")}throw Error("No annotation service found. Commenting is likely not enabled.")}))}function g(t){return t.features&&t.features.length&&t.features.forEach((function(t){var e;(e=t).attributes=n(n({},{status:"pending",source:"hub.js"}),e.attributes)})),d(t)}function v(t){return h(t)}async function D(t,e){return{results:(await u({q:t,authentication:e})).results.reduce((t,e)=>(t.push(C(e)),t),[])}}async function j(t,e,a){console.log("hub-member: updateMember",t,e);let n=async function(t){var e;return(e=t).tags=e.tags.concat(e.metadata.interests.map(t=>"interest:"+t)),e}(e);return i({user:Object.assign({username:t},n),authentication:a}),N(t,a)}async function N(t,e){return C(await r({username:t,authentication:e}))}function A(){return C({username:"",fullName:"Anonymous",thumbnail:""})}async function O(e){let a=(await o({q:"tags:Hub Event Group",params:{searchUserAccess:"groupMember",num:100},authentication:e})).results.reduce((t,e)=>(t.push(`groupId = '${e.id}'`),t),[]),n=await c(null,{authentication:e});const r=b("upcoming",{url:`https://hub.arcgis.com/api/v3/events/${n.id}/Hub%20Events/FeatureServer/0/`,authentication:e});r.where+=` AND (${a.join(" OR ")})`;let s=await f(r);console.log("hub-member: getMemberEvents",[r,s]);let u=s.data.reduce((e,a)=>(e.push({id:a.id,name:a.attributes.title,summary:a.attributes.venue,description:a.attributes.description,hubtype:t.event}),e),[]);return{results:u,meta:{total:a.length,count:u.length,start:1}}}async function $(t,e,n){let r=await function(t){const e=`https://www.arcgis.com/sharing/rest/community/users/${t.username}/addresource`;return t.params=Object.assign({text:t.content,key:t.name,file:t.resource},t.params),a(e,t)}({username:t,name:"places.json",content:JSON.stringify({places:e}),authentication:n});return console.log("hub-member: getMemberPlaces",e),r.success}async function S(t,e){let n;try{n=await async function(t,e,n){const r=`https://www.arcgis.com/sharing/rest/community/users/${t}/resources/places.json`,s=Object.assign({},n);return s.params=Object.assign({num:1e3},s.params),a(r,s)}(t,0,{authentication:e})}catch(r){n={places:[]}}return console.log("hub-member: getMemberPlaces",n),n.places}async function E(t){let e=await o({q:"tags:initiativeCollaborationGroup",params:{searchUserAccess:"groupMember",num:100},authentication:t});return{results:e.results.reduce((t,e)=>(t.push(_(e)),t),[]),meta:{total:e.total,count:e.num,start:e.start}}}async function q(t,e){let a=["1=1"];a.push(`Creator LIKE '${t}'`);let n,r=await c(null,{authentication:e}),s=await y(r.id);s+="/0";try{console.log("hub-discussion: Search",[l,a,{url:s,params:{where:a.join(" AND ")}}]),n=await w({url:s,where:a.join(" AND ")})}catch(u){n={data:[]}}return n.data}async function M(t,e){return await l({owner:t,authentication:e})}function k(t){var e;return null===(e=t.tags)||void 0===e?void 0:e.reduce((t,e)=>{let a=e.match(/^interest:(.*)/);return console.log("usersInterests",a),a&&t.push(a[1]),t},[])}function C(a){let n=Object.assign(a,{id:a.username,name:a.fullName||a.username,publisher:{name:a.username,username:a.username},hubtype:t.member,summary:a.description||"No profile summary.",description:a.description||"No profile description.",hubType:t.member,url:"https://www.arcgis.com/home/user.html?user="+a.username,permissions:{visibility:e.public},createdDate:new Date(a.created),createdDateSource:"user.created",updatedDate:new Date(a.modified),updatedDateSource:"user.modified",thumbnailUrl:"",culture:a.culture,region:a.region,metadata:{interests:k(a)}});return null!=a.thumbnail&&(n.thumbnailUrl=`https://www.arcgis.com/sharing/rest/community/users/${a.username}/info/${a.thumbnail}`),n}async function I(t){let e=await o(t);return{results:e.results.reduce((t,e)=>(t.push(_(e)),t),[]),meta:{total:e.total,count:e.num,start:e.start}}}async function U(t){return _(await m(t))}function _(a){let n=Object.assign(a,{id:a.id,name:a.title,hubtype:t.team,publisher:{name:a.owner,username:a.owner},summary:a.snippet||a.description||"No profile summary.",description:a.description||"No profile description.",hubType:t.team,url:"https://www.arcgis.com/home/group.html?id="+a.id,permissions:{visibility:e[a.access]},createdDate:new Date(a.created),createdDateSource:"group.created",updatedDate:new Date(a.modified),updatedDateSource:"group.modified",thumbnailUrl:"",culture:a.culture,region:a.region});return void 0!==a.thumbnail&&null!==n.thumbnail&&(n.thumbnailUrl=`https://www.arcgis.com/sharing/rest/community/groups/${a.id}/info/${a.thumbnail}`),n}export{I as a,w as b,A as c,v as d,C as e,U as f,y as g,N as h,E as i,O as j,S as k,M as l,q as m,g as n,$ as o,D as s,j as u}