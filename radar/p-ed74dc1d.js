import{H as t,V as e}from"./p-751e2ca3.js";import{r as n,_ as a}from"./p-0609b493.js";import{d as r,c as s,e as u,f as i,h as o,i as c,k as m}from"./p-ae78f844.js";import{s as l}from"./p-61f25cd6.js";import{q as p,a as d,d as h,g as f,s as b}from"./p-13660828.js";function w(t){return t.outFields||(t.outFields=["OBJECTID","Creator","Editor","created_at","updated_at","description","source","status","target","dataset_id"]),(null==t.where||t.where.length<=0)&&(t.where="1=1"),t.where+=" AND parent_id IS NULL",console.log("hub-annotations: searchAnnotations: requestOptions",t),p(t).then((function(e){var n=[],a=[];e.features.forEach((function(t){var e=t.attributes,r=t.geometry,s={id:e.OBJECTID,type:"annotations",attributes:e};r&&(s.geometry=r),a.push(s),-1===n.indexOf(e.Creator)&&n.push(e.Creator)}));var s=n.filter((function(t){return""!==t})).map((function(e){return r({username:e,portal:t.portal,authentication:t.authentication}).catch((function(){return null}))}));return Promise.all(s).then((function(t){var e=[];return t.forEach((function(t){t&&e.push({id:t.username,type:"users",attributes:t})})),{included:e,data:a}}))}))}function y(t,e){return s(a({q:"typekeywords:hubAnnotationLayer AND orgid:"+t},e)).then((function(t){if(t.results&&t.results.length>0){var e=t.results[0].url;return e.replace(/^http:/gi,"https:")}throw Error("No annotation service found. Commenting is likely not enabled.")}))}function g(t){return t.features&&t.features.length&&t.features.forEach((function(t){var e;(e=t).attributes=a(a({},{status:"pending",source:"hub.js"}),e.attributes)})),d(t)}function v(t){return h(t)}async function D(t,e){return{results:(await u({q:t,authentication:e})).results.reduce((t,e)=>(t.push(C(e)),t),[])}}async function j(t,e,n){console.log("hub-member: updateMember",t,e);let a=async function(t){var e;return(e=t).tags=e.tags.concat(e.metadata.interests.map(t=>"interest:"+t)),e}(e);return i({user:Object.assign({username:t},a),authentication:n}),N(t,n)}async function N(t,e){return C(await r({username:t,authentication:e}))}function A(){return C({username:"",fullName:"Anonymous",thumbnail:""})}async function O(e){let n=(await o({q:"tags:Hub Event Group",params:{searchUserAccess:"groupMember",num:100},authentication:e})).results.reduce((t,e)=>(t.push(`groupId = '${e.id}'`),t),[]),a=await c(null,{authentication:e});const r=f("upcoming",{url:`https://hub.arcgis.com/api/v3/events/${a.id}/Hub%20Events/FeatureServer/0/`,authentication:e});r.where+=` AND (${n.join(" OR ")})`;let s=await b(r);console.log("hub-member: getMemberEvents",[r,s]);let u=s.data.reduce((e,n)=>(e.push({id:n.id,name:n.attributes.title,summary:n.attributes.venue,description:n.attributes.description,hubtype:t.event}),e),[]);return{results:u,meta:{total:n.length,count:u.length,start:1}}}async function $(t,e,a){let r=await function(t){const e=`https://www.arcgis.com/sharing/rest/community/users/${t.username}/addresource`;return t.params=Object.assign({text:t.content,key:t.name,file:t.resource},t.params),n(e,t)}({username:t,name:"places.json",content:JSON.stringify({places:e}),authentication:a});return console.log("hub-member: getMemberPlaces",e),r.success}async function S(t,e){let a;try{a=await async function(t,e,a){const r=`https://www.arcgis.com/sharing/rest/community/users/${t}/resources/places.json`,s=Object.assign({},a);return s.params=Object.assign({num:1e3},s.params),n(r,s)}(t,0,{authentication:e})}catch(r){a={places:[]}}return console.log("hub-member: getMemberPlaces",a),a.places}async function E(t){let e=await o({q:"tags:initiativeCollaborationGroup",params:{searchUserAccess:"groupMember",num:100},authentication:t});return{results:e.results.reduce((t,e)=>(t.push(_(e)),t),[]),meta:{total:e.total,count:e.num,start:e.start}}}async function q(t,e){let n=["1=1"];n.push(`Creator LIKE '${t}'`);let a,r=await c(null,{authentication:e}),s=await y(r.id);s+="/0";try{console.log("hub-discussion: Search",[l,n,{url:s,params:{where:n.join(" AND ")}}]),a=await w({url:s,where:n.join(" AND ")})}catch(u){a={data:[]}}return a.data}async function M(t,e){return await l({owner:t,authentication:e})}function k(t){var e;return null===(e=t.tags)||void 0===e?void 0:e.reduce((t,e)=>{let n=e.match(/^interest:(.*)/);return console.log("usersInterests",n),n&&t.push(n[1]),t},[])}function C(n){let a=Object.assign(n,{id:n.username,name:n.fullName||n.username,publisher:{name:n.username,username:n.username},hubtype:t.member,summary:n.description||"No profile summary.",description:n.description||"No profile description.",hubType:t.member,url:"https://www.arcgis.com/home/user.html?user="+n.username,permissions:{visibility:e.public},createdDate:new Date(n.created),createdDateSource:"user.created",updatedDate:new Date(n.modified),updatedDateSource:"user.modified",thumbnailUrl:"",culture:n.culture,region:n.region,metadata:{interests:k(n)}});return null!=n.thumbnail&&(a.thumbnailUrl=`https://www.arcgis.com/sharing/rest/community/users/${n.username}/info/${n.thumbnail}`),a}async function I(t){let e=await o(t);return{results:e.results.reduce((t,e)=>(t.push(_(e)),t),[]),meta:{total:e.total,count:e.num,start:e.start}}}async function U(t){return _(await m(t))}function _(n){let a=Object.assign(n,{id:n.id,name:n.title,hubtype:t.team,publisher:{name:n.owner,username:n.owner},summary:n.snippet||n.description||"No profile summary.",description:n.description||"No profile description.",hubType:t.team,url:"https://www.arcgis.com/home/group.html?id="+n.id,permissions:{visibility:e[n.access]},createdDate:new Date(n.created),createdDateSource:"group.created",updatedDate:new Date(n.modified),updatedDateSource:"group.modified",thumbnailUrl:"",culture:n.culture,region:n.region});return void 0!==n.thumbnail&&null!==a.thumbnail&&(a.thumbnailUrl=`https://www.arcgis.com/sharing/rest/community/groups/${n.id}/info/${n.thumbnail}`),a}export{I as a,w as b,A as c,v as d,C as e,U as f,y as g,N as h,E as i,O as j,S as k,M as l,q as m,g as n,$ as o,D as s,j as u}