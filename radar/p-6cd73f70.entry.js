import{r as t,c as i,h as s,H as e}from"./p-1fd9320b.js";import"./p-ab9e545c.js";import"./p-3a73ba05.js";import"./p-25b1b343.js";import"./p-e094b97e.js";import"./p-3a912305.js";import"./p-fbebadbb.js";import{U as a}from"./p-87086a15.js";import"./p-51001fa3.js";import{h as o,n}from"./p-0f01cfa0.js";import{r}from"./p-f4f99a31.js";const l=class{constructor(s){t(this,s),this.allowReply=!0,this.allowEdit=!1,this.allowDelete=!1,this.eventDeleteAnnotation=i(this,"eventDeleteAnnotation",7)}deleteAnnotation(t){t.preventDefault(),this.eventDeleteAnnotation.emit(this.annotationId)}render(){return s(e,null,s("slot",null),s("div",{class:"comment",id:this.annotationId},s("div",{class:"avatar"},this.authorImage?s("img",{src:this.authorImage}):""),s("div",{class:"content"},s("a",{class:"author"},this.authorName),s("div",{class:"metadata"},s("span",{class:"published-date"},this.publishedDate)),s("div",{class:"text"},this.description),s("div",{class:"actions"},this.allowReply?s("a",{class:"reply"},"Reply"):"",this.allowDelete?s("a",{class:"delete",onClick:t=>this.deleteAnnotation(t)},"Delete"):""))))}};l.style=":host{display:block}.comment{position:relative;background:0 0;margin:.5em 0 0;padding:.5em 0 0;border:none;border-top:none;line-height:1.2}.avatar{display:block;width:2.5em;height:2.5em;float:left;margin:.2em 0 0}.avatar img{display:block;margin:0 auto;width:100%;height:100%;border-radius:.25rem}.author{font-weight:600}.metadata{display:inline-block;margin-left:.5em;color:rgba(0,0,0,.4);font-size:.875em}.metadata>*{display:inline-block;margin:0 .5em 0 0}.content{margin-left:3.5em}.text{margin:.25em 0 .5em;font-size:1em;word-wrap:break-word;color:rgba(0,0,0,.87);line-height:1.3}.actions{font-size:.875em}.actions a{cursor:pointer;display:inline-block;margin:0 .75em 0 0;color:rgba(0,0,0,.4)}.actions a:hover{text-decoration:underline;color:rgba(0,0,0,0.8)}";const c=class{constructor(s){t(this,s),this.placeholder="Join the discussion...",this.submit="Share comment",this.eventAddAnnotation=i(this,"eventAddAnnotation",7)}async componentWillLoad(){this.session=r();const t=a.deserialize(this.session);console.log("Session",this.session),void 0!==this.session&&(this.member=await o(JSON.parse(this.session).username,t))}submitAnnotation(t){if(this.error=null,t.preventDefault(),0===this.inputEl.value.length)return;let i={content:this.inputEl.value,target:this.target,author:this.member.username,createdDate:new Date};this.commitAnnotation(i)}clearAnnotation(){this.inputEl.value=""}async commitAnnotation(t){let i={attributes:Object.assign({target:t.target,description:t.content,created_at:t.createdDate.getTime(),updated_at:t.createdDate.getTime()},t),geometry:t.geometry},s=await n({url:this.annotationsUrl,features:[i],authentication:a.deserialize(this.session)});s&&s.addResults[0].success?(this.eventAddAnnotation.emit({newAnnotation:t}),this.clearAnnotation()):(this.errorEl.open(),this.error=s.addResults[0].error.description)}render(){return s(e,null,s("slot",null),s("div",{class:"annotation-entry"},s("textarea",{placeholder:this.placeholder,ref:t=>this.inputEl=t}),s("br",null),s("calcite-button",{onClick:t=>this.submitAnnotation(t)},this.submit),s("calcite-alert",{ref:t=>this.errorEl=t,autoDismiss:!0,color:"red",scale:"s"},s("div",{slot:"alert-title"},"There was a problem adding your comment."),s("div",{slot:"alert-message"},this.error))))}};c.style=":host{display:block}.annotation-entry textarea{background:rgba(0, 0, 0, 0) none repeat scroll 0 0;color:#4c4c4c;font-size:1em;min-height:3em;width:80%;padding-left:5px}calcite-button{height:3em}";export{l as discussion_entry,c as discussion_input}