import{r as t,h as i}from"./p-1fd9320b.js";import{r as e,f as n}from"./p-3a73ba05.js";import{g as r,a as o,b as s,o as u,j as a,l as c}from"./p-25b1b343.js";import{b as f,j as p,u as l}from"./p-e094b97e.js";import{U as m}from"./p-87086a15.js";import{a as h}from"./p-f4f99a31.js";function d(t,i,e,n){var r=(e||"https://www.arcgis.com/sharing/rest")+"/content/items/"+t+"/resources";return n?r+"/"+n+"/"+i:r+"/"+i}var v=function(t){return{id:t.id,name:t.field.name,alias:t.field.alias,type:t.field.type}},g=function(t){return{type:"Feature Layer",url:t.url,itemId:t.itemId,layerId:t.layerId,name:t.name||t.id,mappings:t.fields.map(v)}},w=function(t){return{id:t.id,type:"Data",name:t.name||t.id,definition:{description:t.name||t.id},source:g(t)}};function y(t){return t.id}function I(t){if(f(t,"item.properties.schemaVersion")<2){var i=p(t);return i.item.properties.schemaVersion=2,i.data.steps=function(t,i){return t&&Array.isArray(t)?t.map((function(t){return n=(e=i[t]).items||[],{title:e.title,description:e.description,id:e.id,templateIds:(e.templates||[]).map(y),itemIds:n.map(y)};var e,n})):[]}(i.data.values.steps,i.data.values),i.data.values.steps&&(i.data.values.steps.forEach((function(t){delete i.data.values[t]})),delete i.data.values.steps),i.data.indicators=function(t){return Object.keys(t).reduce((function(i,e){var n=t[e];if(function(t){var i=!1;return Array.isArray(t.fields)&&t.fields.length>0&&(i=!0),i}(n)){var r=p(n);r.id=e,i.push(r)}return i}),[])}(i.data.values).map(w),i}return t}function b(t,i){return 2.2===f(t,"item.properties.schemaVersion")?t:t=function(t){var i,e,n=p(t),r=(i=f(n,"data.steps"),e=[],Array.isArray(i)&&(e=i.reduce((function(t,i){return f(i,"templateIds.length")?t.concat(i.templateIds):t}),[])),e),o=f(n,"data.recommendedTemplates")||[],s=r.concat(o);return n.data.recommendedTemplates=s.reduce((function(t,i){return t.indexOf(i)<0&&t.push(i),t}),[]),n}(t=function(t){if(f(t,"item.properties.schemaVersion")<2.1){var i=p(t);i.item.properties.schemaVersion=2.1;var e=f(t,"item.properties.groupId");return e&&(i.item.properties.collaborationGroupId=e,delete i.item.properties.groupId),i}return t}(t=I(t=function(t,i){if(f(t,"item.properties.schemaVersion")<1.1){var e=p(t);return e.item.properties.schemaVersion=1.1,function(t,i){t.data.assets||(t.data.assets=[{id:"bannerImage",url:d(t.item.id,"detail-image.jpg",i),properties:{type:"resource",fileName:"detail-image.jpg",mimeType:"image/jepg"},license:{type:"none"}},{id:"iconDark",url:d(t.item.id,"icon-dark.png",i),properties:{type:"resource",fileName:"icon-dark.png",mimeType:"image/png"},license:{type:"none"}},{id:"iconLight",url:d(t.item.id,"icon-light.png",i),properties:{type:"resource",fileName:"icon-light.png",mimeType:"image/png"},license:{type:"none"}}])}(e,i),e.data.values.bannerImage||(e.data.values.bannerImage={source:"bannerImage",display:{position:{x:"50%",y:"10%"}}}),e}return t}(t=function(t){var i=f(t,"item.properties.schemaVersion");if(!i||i<1){var e=p(t);e.data.values||(e.data.values={}),e.item.properties||(e.item.properties={}),e.item.properties.schemaVersion=1;var n=!1;if(e.item.typeKeywords&&(n=e.item.typeKeywords.indexOf("hubInitiativeTemplate")>=0),!!e.data.source&&e.item.properties.source!==e.data.source&&(e.item.properties.source=e.data.source),e.data.configurationSettings){var r=p(e.data.configurationSettings);delete e.data.configurationSettings;var o=r.find((function(t){return"Steps"===t.category}));e.data.values.steps=o.fields.map((function(t){return t.fieldName})),o.fields.forEach((function(t){e.data.values[t.fieldName]||(e.data.values[t.fieldName]={}),e.data.values[t.fieldName].title=t.label,e.data.values[t.fieldName].description=t.tooltip,e.data.values[t.fieldName].id=t.fieldName,e.data.values[t.fieldName].items?n&&(e.data.values[t.fieldName].templates=e.data.values[t.fieldName].items,delete e.data.values[t.fieldName].items):(e.data.values[t.fieldName].items=[],e.data.values[t.fieldName].templates=[])}))}return e}return t}(t),i))))}function j(t,i){return Promise.all([r(t,i),o(t,i)]).then((function(t){return{item:t[0],data:t[1]}})).then((function(t){return b(t,s(i))}))}var x=function(t){return"hubInitiativeId|"+t},N=function(t){return t.replace(/^hubInitiativeId\|/,"")},O=function(t){return t.replace(/^hubInitiativeFollowers\|/,"")},P=function(t){return u(t)+"/update"},F=function(t){return t.groups.map((function(t){return t.tags})).reduce((function(t,i){return t.concat(i)}),[]).filter((function(t){return 0===t.indexOf("hubInitiativeFollowers|")})).map(O)},S=function(t,i){return function(t){var i=function(t){return t.tags.map(N)}(t),e=F(t);return n(i,e).filter(l)}(t).indexOf(i)>-1};const T=class{constructor(n){t(this,n),this.icon=i("svg",{class:"follow-icon",viewBox:"0 0 120 120",width:"100%",height:"100%"},i("circle",{cx:"18.385",cy:"101.615",r:"18.385"}),i("path",{d:"M-1.031 61c32.533 0 59 26.468 59 59s-26.467 59-59 59-59-26.468-59-59 26.467-59 59-59m0-23c-45.288 0-82 36.713-82 82s36.712 82 82 82 82-36.713 82-82-36.712-82-82-82z"}),i("path",{d:"M.154 23.041c53.349 0 96.75 43.402 96.75 96.75s-43.402 96.75-96.75 96.75-96.75-43.402-96.75-96.75 43.402-96.75 96.75-96.75m0-23c-66.136 0-119.75 53.615-119.75 119.75s53.614 119.75 119.75 119.75c66.135 0 119.75-53.615 119.75-119.75S66.289.041.154.041z"})),this.orgurl="https://www.arcgis.com",this.following=!1,this.followtext="Follow Our Initiative",this.unfollowtext="Unfollow Our Initiative",this.callToActionText=this.followtext,this.triggerFollow=()=>h(this.clientid,this.orgurl).then(t=>(this.session=t,this.toggleFollow())),this.toggleFollow=()=>{return console.log("toggleFollow",this.following),this.following?function(t){return e(u(t.authentication),{authentication:t.authentication}).then((function(i){return S(i,t.initiativeId)?i:Promise.reject("user is not following this initiative.")})).then((function(i){var n=x(t.initiativeId),r=JSON.parse(JSON.stringify(i.tags));if(r.indexOf(n)>-1){var o=r.indexOf(n);return r.splice(o,1),0===r.length&&r.push(","),e(P(t.authentication),{params:{tags:r},authentication:t.authentication}).then((function(){return i}))}return i})).then((function(i){return j(t.initiativeId,t).then((function(t){return{user:i,initiative:t}}))})).then((function(i){var e=f(i,"initiative.item.properties.followersGroupId");return e&&F(i.user).indexOf(t.initiativeId)>-1?c({id:e,authentication:t.authentication}).then((function(){return{success:!0,username:i.user.username}})):{success:!0,username:i.user.username}}))}({initiativeId:this.initiativeid,authentication:m.deserialize(this.session)}).then(t=>{if(t.success)return Promise.resolve()}).catch(t=>{if("user is not following this initiative."===t)return Promise.resolve()}).then(()=>(this.callToActionText=this.unfollowtext,this.following=!1,{success:!0})):(t={initiativeId:this.initiativeid,authentication:m.deserialize(this.session)},e(u(t.authentication),{authentication:t.authentication}).then((function(i){return S(i,t.initiativeId)?Promise.reject("user is already following this initiative."):i})).then((function(i){return j(t.initiativeId,t).then((function(t){return{user:i,initiative:t,hasFollowersGroup:!1}}))})).then((function(i){var e=f(i,"initiative.item.properties.followersGroupId");return e?a({id:e,authentication:t.authentication}).then((function(t){return i.hasFollowersGroup=t.success,i})):i})).then((function(i){if(!i.hasFollowersGroup){var n=x(t.initiativeId),r=JSON.parse(JSON.stringify(i.user.tags));return r.push(n),e(P(t.authentication),{params:{tags:r},authentication:t.authentication})}return{success:!0,username:i.user.username}}))).then(t=>{if(t.success)return Promise.resolve(t)}).catch(t=>{if("user is already following this initiative."===t)return Promise.resolve()}).then(()=>(this.callToActionText=this.followtext,this.following=!0,{success:!0}));var t}}render(){return i("hub-button",{text:this.callToActionText,action:this.triggerFollow,icon:this.icon})}};T.style=".follow-icon{height:15px;width:15px;vertical-align:baseline;padding-right:5px;fill:currentColor}";export{T as hub_follow_button}