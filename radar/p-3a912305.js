import{_ as t,b as n,d as e}from"./p-3a73ba05.js";import{c as r}from"./p-25b1b343.js";import{c as a,b as i,a as o,d as u,e as c,f,h as s}from"./p-e094b97e.js";var p=a.apiTypes.map((function(t){return t.toLowerCase()}));function l(t){return Object.keys(t).reduce((function(n,e){return n[e]=Object.keys(t[e]).reduce((function(n,r){return n.push({key:r,docCount:t[e][r]}),n}),[]).sort(d),n}),{})}function d(t,n){return n.docCount>t.docCount?1:-1}var y=["tags","type","access","categories"],v={collection:"type"},g=["title","created","type","owner","modified","avgrating","numratings","numcomments","numviews"],m={name:"title"},b={orgId:{type:"filter",dataType:"string",defaultOp:"any",catalogDefinition:!0},q:{type:"simple"},page:{type:"simple"},tags:{type:"filter",dataType:"string",defaultOp:"any"},source:{type:"filter",dataType:"string",defaultOp:"any"},bbox:{type:"simple"},location_name:{type:"simple"},sort:{type:"simple"},groupIds:{type:"filter",dataType:"string",defaultOp:"any",catalogDefinition:!0},catalog:{type:"simple"},owner:{type:"filter",dataType:"string",defaultOp:"any"},access:{type:"filter",dataType:"string",defaultOp:"any"},type:{type:"filter",dataType:"string",defaultOp:"any"},hubType:{type:"filter",dataType:"string",defaultOp:"any"},downloadable:{type:"filter",dataType:"boolean"},hasApi:{type:"filter",dataType:"boolean"},openData:{type:"filter",dataType:"boolean"},id:{type:"filter",dataType:"string",defaultOp:"any",catalogDefinition:!0},collection:{type:"filter",dataType:"string",defaultOp:"any"},sector:{type:"filter",dataType:"string",defaultOp:"any"},region:{type:"filter",dataType:"string",defaultOp:"any"},initiativeId:{type:"filter",dataType:"string",defaultOp:"any",catalogDefinition:!0},categories:{type:"filter",dataType:"string",defaultOp:"any"},license:{type:"filter",dataType:"string",defaultOp:"any"},modified:{type:"filter",dataType:"string",defaultOp:"between"}};function O(t){return t?Object.keys(t).reduce((function(n,e){var r=b[e]||{};return t[e]&&"filter"===r.type&&r.dataType&&(n[e]=function(t,n){var e=t.match(/(any|all|between)\((.+)\)/);return e?{fn:e[1],terms:e[2].split(","),catalogDefinition:n.catalogDefinition}:{fn:n.defaultOp||null,terms:t.split(","),catalogDefinition:n.catalogDefinition}}(t[e],r)),n}),{}):{}}function h(t){return{any:" OR ",all:" AND ",not:" NOT ",between:" TO "}[t||"any"]}var T={downloadable:function(t){var n,e;return"true"===(i(t,"downloadable.terms")||[])[0]?(n=a.downloadableTypes.map((function(t){return'type:"'+t+'"'})),e=a.downloadableTypeKeywords.map((function(t){return'typekeywords:"'+t+'"'}))):(n=a.downloadableTypes.map((function(t){return'-type:"'+t+'"'})),e=a.downloadableTypeKeywords.map((function(t){return'-typekeywords:"'+t+'"'}))),"("+n.concat(e).join(" OR ")+")"},hasApi:function(t){return"("+((i(t,"hasApi.terms")||[])[0]?a.apiTypes.map((function(t){return'type:"'+t+'"'})).join(" OR "):a.apiTypes.map((function(t){return'-type:"'+t+'"'})).join(" OR "))+")"},groupIds:function(t){return"("+(i(t,"groupIds.terms")||[]).map((function(t){return'group:"'+t+'"'})).join(" OR ")+")"},collection:function(t){return"("+(i(t,"collection.terms")||[]).map((function(t){return c(t)})).filter((function(t){return!!t})).reduce((function(t,n){return n.forEach((function(n){t.push('type:"'+n+'"')})),t}),[]).join(" OR ")+")"}};function w(t){var n=[],e=[];if(Object.keys(t).forEach((function(r){var a;a=T[r]?T[r](t,r):function(t,n){var e,r=i(t,n+".terms")||[],a=i(t,n+".fn");if("between"===a){var o=r[0],c=r[1];o===c&&(c=u(o,1));var f=[o,c].map((function(t){return new Date(t).getTime()}));e=n.toLowerCase()+": ["+f.join(h(a))+"]"}else e=r.map((function(t){return n.toLowerCase()+':"'+t+'"'})).join(h(a));return"not"===a&&(e="NOT "+e),"("+e+")"}(t,r),t[r].catalogDefinition?n.push(a):e.push(a)})),n.length){var r="("+n.join(" OR ")+")";return e.length?r+" AND ("+e.join(" AND ")+")":r}return e.length?e.join(" AND "):""}function j(a,o,u,c){return n(this,void 0,void 0,(function(){var n,s,p,l,d,b,h,T;return e(this,(function(e){switch(e.label){case 0:return(n=function(n){void 0===n&&(n={});var e={q:null,start:i(n,"page.start")||1,num:i(n,"page.size")||10},r=['-type:"code attachment"'];if(n.restricted&&r.push("-access:public"),n.q&&r.push(n.q),n.catalog){var a=O(n.catalog);r.push(w(a))}var o,u,c,f,s=O(n),p=O(n.filter),l=t(t({},s),p);if(Object.keys(l).length&&r.push(w(l)),r=r.filter((function(t){return!!t})),e.q=r.join(" AND "),n.bbox&&(e.bbox=n.bbox),n.sort){var d="-"===n.sort[0]?"desc":"asc",b="desc"===d?n.sort.substring(1).split(",")[0]:n.sort.split(",")[0];(b=g.indexOf(o=b)>=0?o:o in m?m[o]:void 0)&&(e.sortField=b,e.sortOrder=d)}if(n.agg&&n.agg.fields){var h;h=Array.isArray(n.agg.fields)?n.agg.fields.join(","):n.agg.fields;var T=(c=(u=h).split(",").filter((function(t){return y.indexOf(t)>-1})),f=u.split(",").filter((function(t){return Object.keys(v).indexOf(t)>-1})),Object.keys(v).forEach((function(t){f.indexOf(t)>-1&&!(v[t]in c)&&c.push(v[t])})),{countFields:c.join(","),countSize:200}),j=T.countSize;e.countFields=T.countFields,e.countSize=j}return e}(a)).countFields?(s=f(n.countFields.split(","),3).map((function(t){return t.join(",")})),p=s.map((function(e){return r(t(t({},n),{params:{token:o,countFields:e,countSize:n.countSize},portal:u,authentication:c}))})),[4,Promise.all(p)]):[3,2];case 1:for(l=e.sent(),d=[],b=0,h=l;b<h.length;b++)T=i(h[b],"aggregations.counts")||[],d=d.concat(T);return l[0].aggregations={counts:d},[2,l[0]];case 2:return[2,r(t(t({},n),{params:{token:o,countFields:n.countFields,countSize:n.countSize},portal:u,authentication:c}))]}}))}))}var D=["downloadable"],A=["hasApi","collection"],R={downloadable:function(t){return t.results.reduce((function(t,n){return(n.typeKeywords||[]).indexOf("Data")>-1||a.downloadableTypes.indexOf(n.type)>-1?t.downloadable.true++:t.downloadable.false++,t}),{downloadable:{true:0,false:0}})},hasApi:function(t){void 0===t&&(t={});var n=(i(t,"counts")||[]).filter((function(t){return"type"===t.fieldName}))[0];return n?n.fieldValues.reduce((function(t,n){return p.indexOf(n.value)>-1?t.hasApi.true+=n.count:t.hasApi.false+=n.count,t}),{hasApi:{true:0,false:0}}):{hasApi:{}}},collection:function(t){void 0===t&&(t={});var n=(i(t,"counts")||[]).filter((function(t){return"type"===t.fieldName}))[0];return n?n.fieldValues.reduce((function(t,n){var e,r=o(n.value);return e=r?r.toLowerCase().split(" ").map((function(t){return t.charAt(0).toUpperCase()+t.slice(1)})).join(" "):"Other",t.collection[e]=n.count,t}),{collection:{}}):{collection:{}}}};function k(r,a,o,u,c){return void 0===r&&(r={counts:Array()}),n(this,void 0,void 0,(function(){var n,f,s,p,d,y,v,g,m;return e(this,(function(e){switch(e.label){case 0:return n=i(a,"agg.fields"),f=n?n.split(","):[],s=I(f,D),p={},s.length>0?((d=t(t({},a),{start:1,num:100})).agg={},[4,j(d,o,u,c)]):[3,2];case 1:y=e.sent(),s.forEach((function(n){var e=R[n](y);p=t(t({},p),l(e))})),e.label=2;case 2:return v=r.counts.reduce((function(t,n){return t[n.fieldName]=n.fieldValues.map((function(t){return{key:t.value,docCount:t.count}})),t}),{}),s=I(f,A),g={},s.length>0&&s.forEach((function(n){var e=t({},R[n](r));g=t(t({},g),l(e))})),(m=t(t(t({},p),v),g)).categories&&(m.categories=function(t){void 0===t&&(t=[]);var n=new Set,e=["","categories"];return t.forEach((function(t){t.key.split("/").filter((function(t){return-1===e.indexOf(t)})).forEach((function(t){n.add(t)}))})),Array.from(n).reduce((function(n,e){var r=t.filter((function(t){return t.key.includes(e)})).map((function(t){return t.docCount})).reduce((function(t,n){return t+n}));return n.push({key:e,docCount:r}),n}),[])}(m.categories)),[2,m]}}))}))}function I(t,n){return t.filter((function(t){return-1!==n.indexOf(t)}))}function C(t,n,e){if(t)try{var r=t.match(new RegExp(n,"ig"));if(!r)return;return r.reduce(function(t){return function(n,e){var r='<mark class="hub-search-highlight '+t+'-highlight">'+e+"</mark>";return n.replace(new RegExp(e,"g"),r)}}(e),t)}catch(a){return}}function N(n){var e,r=o(n.type),a={name:n.title,searchDescription:n.description,hubType:r||"Other",collection:s(n),extent:(e=n.extent,{coordinates:e,type:"envelope"})};return t(t({},n),a)}function x(r,a,i,o){return n(this,void 0,void 0,(function(){var n,u;return e(this,(function(e){switch(e.label){case 0:return[4,j(r,a,i,o)];case 1:return[4,k((n=e.sent()).aggregations,r,a,i)];case 2:return u=e.sent(),[2,function(n,e,r){void 0===e&&(e={});var a=t({},r);return{data:n.results.map((function(t){return e=a.q,r={id:(n=t).id,type:"item",attributes:N(n)},e&&(r.meta={},r.meta.highlights=function(t,n){return{name:C(t.title,n,"name"),searchDescription:C(t.description,n,"description")}}(n,e)),r;var n,e,r})),meta:{query:n.query,queryParameters:a,stats:{aggs:e,count:n.results.length,totalCount:n.total},page:{start:n.start,size:n.num,nextStart:n.nextStart}}}}(n,u,r)]}}))}))}function z(t){var n,e=(void 0===(n=O(t))&&(n={}),Object.keys(n).map((function(t){var e=n[t],r=e.fn,a=e.terms,i=encodeURIComponent((e.catalogDefinition?"catalog":"filter")+"["+t+"]"),o=a.map(encodeURIComponent).join(",");return r?i+"="+r+"("+o+")":i+"="+o})).join("&")),r=Object.keys(t).filter((function(t){return!(b[n=t]&&"filter"===b[n].type);var n})),a={};r.forEach((function(n){a[n]=t[n]}));var o=function(t){void 0===t&&(t={});var n=function(t){void 0===t&&(t={});for(var n=[],e=[{obj:t,path:[]}],r=function(){var t=e.pop();Object.keys(t.obj).forEach((function(r){if("object"==typeof t.obj[r]){var a=t.path.concat(r);n.push(a),e.unshift({obj:t.obj[r],path:a})}else n.push(t.path.concat(r))}))};e.length>0;)r();return n}(t).filter((function(n){return"object"!=typeof i(t,n.join("."))})),e=[];return n.forEach((function(n){for(var r="",a=0;a<n.length;a++)r+=0===a?n[a]:"["+n[a]+"]";var o=encodeURIComponent(i(t,n.join("."))||""),u=encodeURIComponent(r);return o&&e.push(u+"="+o),r})),e.join("&")}(a),u=[];return o&&u.push(o),e&&u.push(e),u.join("&")}export{x as a,z as s}