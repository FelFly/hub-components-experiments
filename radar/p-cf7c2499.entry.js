import{r as t,c as i,h as e,H as s}from"./p-1fd9320b.js";import"./p-751e2ca3.js";import"./p-0609b493.js";import"./p-ae78f844.js";import"./p-2c58a2fe.js";import"./p-0d8b64e7.js";import"./p-61f25cd6.js";import{U as a}from"./p-6e1507d1.js";import"./p-13660828.js";import{h as o,n}from"./p-ed74dc1d.js";import{r}from"./p-52b97c29.js";const l=class{constructor(e){t(this,e),this.allowReply=!0,this.allowEdit=!1,this.allowDelete=!1,this.eventDeleteAnnotation=i(this,"eventDeleteAnnotation",7)}deleteAnnotation(t){t.preventDefault(),this.eventDeleteAnnotation.emit(this.annotationId)}render(){return e(s,null,e("slot",null),e("div",{class:"comment",id:this.annotationId},e("div",{class:"avatar"},this.authorImage?e("img",{src:this.authorImage}):""),e("div",{class:"content"},e("a",{class:"author"},this.authorName),e("div",{class:"metadata"},e("span",{class:"published-date"},this.publishedDate)),e("div",{class:"text"},this.description),e("div",{class:"actions"},this.allowReply?e("a",{class:"reply"},"Reply"):"",this.allowDelete?e("a",{class:"delete",onClick:t=>this.deleteAnnotation(t)},"Delete"):""))))}};l.style=":host{display:block}.comment{position:relative;background:0 0;margin:.5em 0 0;padding:.5em 0 0;border:none;border-top:none;line-height:1.2}.avatar{display:block;width:2.5em;height:2.5em;float:left;margin:.2em 0 0}.avatar img{display:block;margin:0 auto;width:100%;height:100%;border-radius:.25rem}.author{font-weight:600}.metadata{display:inline-block;margin-left:.5em;color:rgba(0,0,0,.4);font-size:.875em}.metadata>*{display:inline-block;margin:0 .5em 0 0}.content{margin-left:3.5em}.text{margin:.25em 0 .5em;font-size:1em;word-wrap:break-word;color:rgba(0,0,0,.87);line-height:1.3}.actions{font-size:.875em}.actions a{cursor:pointer;display:inline-block;margin:0 .75em 0 0;color:rgba(0,0,0,.4)}.actions a:hover{text-decoration:underline;color:rgba(0,0,0,0.8)}";const c=class{constructor(e){t(this,e),this.placeholder="Join the discussion...",this.submit="Share comment",this.eventAddAnnotation=i(this,"eventAddAnnotation",7)}async componentWillLoad(){this.session=r();const t=a.deserialize(this.session);console.log("Session",this.session),void 0!==this.session&&(this.member=await o(JSON.parse(this.session).username,t))}submitAnnotation(t){if(this.error=null,t.preventDefault(),0===this.inputEl.value.length)return;let i={content:this.inputEl.value,target:this.target,author:this.member.username,createdDate:new Date};this.commitAnnotation(i)}clearAnnotation(){this.inputEl.value=""}async commitAnnotation(t){let i={attributes:Object.assign({target:t.target,description:t.content,created_at:t.createdDate.getTime(),updated_at:t.createdDate.getTime()},t),geometry:t.geometry},e=await n({url:this.annotationsUrl,features:[i],authentication:a.deserialize(this.session)});e&&e.addResults[0].success?(this.eventAddAnnotation.emit({newAnnotation:t}),this.clearAnnotation()):(this.errorEl.open(),this.error=e.addResults[0].error.description)}render(){return e(s,null,e("slot",null),e("div",{class:"annotation-entry"},e("textarea",{placeholder:this.placeholder,ref:t=>this.inputEl=t}),e("br",null),e("calcite-button",{onClick:t=>this.submitAnnotation(t)},this.submit),e("calcite-alert",{ref:t=>this.errorEl=t,autoDismiss:!0,color:"red",scale:"s"},e("div",{slot:"alert-title"},"There was a problem adding your comment."),e("div",{slot:"alert-message"},this.error))))}};c.style=":host{display:block}.annotation-entry textarea{background:rgba(0, 0, 0, 0) none repeat scroll 0 0;color:#4c4c4c;font-size:1em;min-height:3em;width:80%;padding-left:5px}calcite-button{height:3em}";export{l as discussion_entry,c as discussion_input}