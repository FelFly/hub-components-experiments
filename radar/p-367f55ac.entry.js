import{r as t,c as s,h as e,g as i}from"./p-1fd9320b.js";import"./p-ab9e545c.js";import"./p-3a73ba05.js";import"./p-25b1b343.js";import"./p-e094b97e.js";import"./p-3a912305.js";import"./p-fbebadbb.js";import{U as a}from"./p-87086a15.js";import"./p-51001fa3.js";import{g as r,d as n,b as o,c as d,e as l}from"./p-0f01cfa0.js";import{r as h}from"./p-f4f99a31.js";const c=class{constructor(e){t(this,e),this.allowReply=!0,this.portalUrl="https://www.arcgis.com",this.authors={},this.searchOptions={},this.newResponse=s(this,"newResponse",7)}eventAddAnnotation(t){console.log("Event: eventAddAnnotation",t),this.addAnnotation(t.detail.annotation)}addAnnotation(t){this.updateAnnotations(),this.newResponse.emit(t)}queryUpdated(){this.updateAnnotations()}targetUpdated(t){console.log("hub-discussion: Updated discussion target",t),this.updateAnnotations()}componentWillLoad(){return this.session=h(),this.session&&(this.username=JSON.parse(this.session).username),null==this.target?this.target="":this.searchOptions.target=this.target,r(this.org).then(t=>(this.annotationsUrl=t+"/0",this.updateAnnotations()))}updateAnnotations(){return this.getAnnotations().then(t=>{this.annotations=t.data;for(let s=0;s<t.included.length;s++)void 0===this.authors[t.included[s].id]&&(this.authors[t.included[s].id]=t.included[s].attributes)})}deleteAnnotation(t){console.log("deleteAnnotations",t),n({url:this.annotationsUrl,objectIds:[t]}).then(t=>(console.log("deleteAnnotations",t),this.updateAnnotations()))}getAnnotations(){let t=["1=1"];return this.query&&t.push(`description LIKE '%${this.query}%'`),this.target&&t.push(`target LIKE '${this.target}'`),o({url:this.annotationsUrl,where:t.join(" AND ")})}searchChanged(t){return this.query=t.target.value,this.updateAnnotations()}getElementById(t){for(let s=0;s<this.el.childElementCount;s++)if(this.el.children[s].getAttribute("id")==t)return this.el.children[s];return null}async removeAnnotation(t){console.log("removeAnnotation",[t.target.id,t]);const s=t.detail;let e=await n({url:this.annotationsUrl,objectIds:[s],authentication:a.deserialize(this.session)});console.debug("hub-discussion: removeAnnotation response",e),this.updateAnnotations()}getAuthor(t){return console.log("getAuthor 1",[t,this.authors[t]]),0===t.length?this.authors[t]||d():(console.log("getAuthor 2",[t,l(this.authors[t])]),l(this.authors[t]))}formatDate(t){return new Date(t).toLocaleString()}discussionCard(t){return e("calcite-card",{class:"gallery-card",selectable:!0},e("img",{class:"card-image",slot:"thumbnail"}),e("h3",{slot:"title"},e("img",{src:this.getAuthor(t.attributes.Creator).thumbnailUrl}),this.getAuthor(t.attributes.Creator).name),e("span",{slot:"subtitle"}),t.attributes.description,e("span",{slot:"footer-leading"},this.formatDate(t.attributes.created_at)))}renderGallery(){let t=[];return this.annotations.map(s=>{t.push(this.discussionCard(s))}),e("div",{class:"search-results gallery-lg "},t)}renderList(){let t=[],s=this.getElementById("annotation-header");var i="Comments";return null!==s&&(i=s.innerHTML),t.push(e("div",{class:"headind_srch"},e("div",{class:"recent_heading"},e("h4",{innerHTML:i})),e("div",{class:"srch_bar"},e("div",{class:"stylish-input-group"},e("input",{type:"text",class:"search-bar",placeholder:"Search",onChange:t=>this.searchChanged(t)}),e("span",{class:"input-group-addon"},e("button",{type:"button"}," ",e("i",{class:"fa fa-search","aria-hidden":"true"})," ")))))),t.push(e("div",{class:"discussion-list"},this.annotations.map(t=>e("discussion-entry",{annotationId:t.attributes.OBJECTID,authorImage:this.getAuthor(t.attributes.Creator).thumbnailUrl,authorName:this.getAuthor(t.attributes.Creator).name,description:t.attributes.description,publishedDate:this.formatDate(t.attributes.created_at),allowReply:this.allowReply&&t.attributes.Creator!==this.username,allowDelete:t.attributes.Creator===this.username,allowEdit:t.attributes.Creator===this.username})))),this.username&&t.push(e("discussion-input",{target:this.target,annotationsUrl:this.annotationsUrl})),t}render(){return this.renderList()}get el(){return i(this)}static get watchers(){return{query:["queryUpdated"],target:["targetUpdated"]}}};c.style=':host{display:block}@media screen and (max-width: 530px){.gallery-card{width:calc((100% - (0 * 30px))/ 1)}}@media screen and (min-width: 530px) and (max-width: 975px){.gallery-card{width:calc((100% - (1 * 30px))/ 2)}}@media screen and (min-width: 975px) and (max-width: 1200px){.gallery-card{width:calc((100% - (2 * 30px))/ 3)}}@media screen and (min-width:1200px){.gallery-card{width:calc((100% - (3 * 30px))/ 4)}}.gallery-card{display:-ms-flexbox;display:flex;-ms-flex-flow:column;flex-flow:column;color:#4c4c4c;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-bottom:30px;-webkit-box-shadow:0 0 5px 0 rgba(76,76,76,.25);box-shadow:0 0 5px 0 rgba(76,76,76,.25);}.card-image{height:40px;background-image:url(https://idee.paris.fr/svg/preview-proposal-image.svg);background-size:cover;background-repeat:no-repeat;background-position:center center}.search-grid{display:grid;grid-template:".   search" auto\n    "filters results" auto /\n    12rem 3fr;padding:0 1rem 0 3rem}hub-suggest-input{grid-area:search}.filters{grid-area:filters}.search-results{grid-area:results;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-pack:justify;justify-content:space-between}.recent_heading{float:left;width:40%}.srch_bar{display:inline-block;text-align:right;width:60%}.headind_srch{padding:10px 29px 10px 20px;overflow:hidden;border-bottom:1px solid #c4c4c4}.recent_heading h4{color:#05728f;font-size:21px;margin:auto}.srch_bar input{border:1px solid #cdcdcd;border-width:0 0 1px 0;width:80%;padding:2px 0 4px 6px;background:none}.srch_bar .input-group-addon button{background:rgba(0, 0, 0, 0) none repeat scroll 0 0;border:medium none;padding:0;color:#707070;font-size:18px}.srch_bar .input-group-addon{margin:0 0 0 -27px}';export{c as hub_discussion}