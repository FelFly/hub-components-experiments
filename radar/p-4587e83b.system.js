var __awaiter=this&&this.__awaiter||function(e,t,r,n){function u(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,i){function a(e){try{o(n.next(e))}catch(t){i(t)}}function s(e){try{o(n["throw"](e))}catch(t){i(t)}}function o(e){e.done?r(e.value):u(e.value).then(a,s)}o((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,u,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return o([e,t])}}function o(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,u&&(i=a[0]&2?u["return"]:a[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,a[1])).done)return i;if(u=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;u=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1];i=a;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(a);break}if(i[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(s){a=[6,s];u=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};System.register(["./p-c74e1ae1.system.js","./p-ad2aa800.system.js","./p-0f2b0e97.system.js","./p-90737b62.system.js","./p-420d31cf.system.js"],(function(e){"use strict";var t,r,n,u,i,a,s,o,c,l,h,f,d,m,p,b,v;return{setters:[function(e){t=e.H;r=e.V},function(e){n=e.r;u=e._},function(e){i=e.d;a=e.c;s=e.e;o=e.f;c=e.h;l=e.i;h=e.k},function(e){f=e.s},function(e){d=e.q;m=e.a;p=e.d;b=e.g;v=e.s}],execute:function(){e({a:J,b:y,c:C,d:E,e:G,f:B,g:D,h:x,i:M,j:U,k:I,l:L,m:T,n:j,o:q,s:S,u:k});var g="https://www.arcgis.com";function _(e,t,r){return __awaiter(this,void 0,void 0,(function(){var u,i;return __generator(this,(function(a){u=g+"/sharing/rest/community/users/"+e+"/resources/"+t;i=Object.assign({},r);i.params=Object.assign({num:1e3},i.params);return[2,n(u,i)]}))}))}function w(e){var t=g+"/sharing/rest/community/users/"+e.username+"/addresource";e.params=Object.assign({text:e.content,key:e.name,file:e.resource},e.params);return n(t,e)}function y(e){if(!e.outFields){e.outFields=["OBJECTID","Creator","Editor","created_at","updated_at","description","source","status","target","dataset_id"]}if(e.where===undefined||e.where===null||e.where.length<=0){e.where="1=1"}e.where+=" AND parent_id IS NULL";console.log("hub-annotations: searchAnnotations: requestOptions",e);return d(e).then((function(t){var r=[];var n=[];t.features.forEach((function(e){var t=e.attributes;var u=e.geometry;var i={id:t.OBJECTID,type:"annotations",attributes:t};if(u){i.geometry=u}n.push(i);if(r.indexOf(t.Creator)===-1){r.push(t.Creator)}}));var u=r.filter((function(e){return e!==""})).map((function(t){return i({username:t,portal:e.portal,authentication:e.authentication}).catch((function(){return null}))}));return Promise.all(u).then((function(e){var t=[];e.forEach((function(e){if(!e){return}t.push({id:e.username,type:"users",attributes:e})}));return{included:t,data:n}}))}))}function D(e,t){return a(u({q:"typekeywords:hubAnnotationLayer AND orgid:"+e},t)).then((function(e){var t=e;if(t.results&&t.results.length>0){var r=t.results[0].url;r=r.replace(/^http:/gi,"https:");return r}else{throw Error("No annotation service found. Commenting is likely not enabled.")}}))}function j(e){if(e.features&&e.features.length){e.features.forEach((function(e){return N(e)}))}return m(e)}function N(e){var t={status:"pending",source:"hub.js"};e.attributes=u(u({},t),e.attributes)}function E(e){return p(e)}var O="https://www.arcgis.com";function S(e,t){return __awaiter(this,void 0,void 0,(function(){var r,n;return __generator(this,(function(u){switch(u.label){case 0:return[4,s({q:e,authentication:t})];case 1:r=u.sent();n=r.results.reduce((function(e,t){e.push(G(t));return e}),[]);return[2,{results:n}]}}))}))}function A(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){e=P(e);t=e;return[2,t]}))}))}function k(e,t,r){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(u){console.log("hub-member: updateMember",e,t);n=A(t);o({user:Object.assign({username:e},n),authentication:r});return[2,x(e,r)]}))}))}function x(e,t){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:return[4,i({username:e,authentication:t})];case 1:r=n.sent();return[2,G(r)]}}))}))}function C(){return G({username:"",fullName:"Anonymous",thumbnail:""})}function U(e){return __awaiter(this,void 0,void 0,(function(){var r,n,u,i,a,s,o;return __generator(this,(function(h){switch(h.label){case 0:return[4,c({q:"tags:Hub Event Group",params:{searchUserAccess:"groupMember",num:100},authentication:e})];case 1:r=h.sent();n=r.results.reduce((function(e,t){e.push("groupId = '"+t.id+"'");return e}),[]);return[4,l(null,{authentication:e})];case 2:u=h.sent();i="https://hub.arcgis.com/api/v3/events/"+u.id+"/Hub%20Events/FeatureServer/0/";a=b("upcoming",{url:i,authentication:e});a.where+=" AND ("+n.join(" OR ")+")";return[4,v(a)];case 3:s=h.sent();console.log("hub-member: getMemberEvents",[a,s]);o=s.data.reduce((function(e,r){e.push({id:r.id,name:r.attributes.title,summary:r.attributes.venue,description:r.attributes.description,hubtype:t.event});return e}),[]);return[2,{results:o,meta:{total:n.length,count:o.length,start:1}}]}}))}))}function q(e,t,r){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(u){switch(u.label){case 0:return[4,w({username:e,name:"places.json",content:JSON.stringify({places:t}),authentication:r})];case 1:n=u.sent();console.log("hub-member: getMemberPlaces",t);return[2,n.success]}}))}))}function I(e,t){return __awaiter(this,void 0,void 0,(function(){var r,n;return __generator(this,(function(u){switch(u.label){case 0:u.trys.push([0,2,,3]);return[4,_(e,"places.json",{authentication:t})];case 1:r=u.sent();return[3,3];case 2:n=u.sent();r={places:[]};return[3,3];case 3:console.log("hub-member: getMemberPlaces",r);return[2,r.places]}}))}))}function M(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:return[4,c({q:"tags:initiativeCollaborationGroup",params:{searchUserAccess:"groupMember",num:100},authentication:e})];case 1:t=n.sent();r=t.results.reduce((function(e,t){e.push(K(t));return e}),[]);return[2,{results:r,meta:{total:t.total,count:t.num,start:t.start}}]}}))}))}function T(e,t){return __awaiter(this,void 0,void 0,(function(){var r,n,u,i,a;return __generator(this,(function(s){switch(s.label){case 0:r=["1=1"];r.push("Creator LIKE '"+e+"'");return[4,l(null,{authentication:t})];case 1:n=s.sent();return[4,D(n.id)];case 2:u=s.sent();u+="/0";s.label=3;case 3:s.trys.push([3,5,,6]);console.log("hub-discussion: Search",[f,r,{url:u,params:{where:r.join(" AND ")}}]);return[4,y({url:u,where:r.join(" AND ")})];case 4:i=s.sent();return[3,6];case 5:a=s.sent();i={data:[]};return[3,6];case 6:return[2,i.data]}}))}))}function L(e,t){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:return[4,f({owner:e,authentication:t})];case 1:r=n.sent();return[2,r]}}))}))}function P(e){e.tags=e.tags.concat(e.metadata.interests.map((function(e){return"interest:"+e})));return e}function F(e){var t;var r=(t=e.tags)===null||t===void 0?void 0:t.reduce((function(e,t){var r=t.match(/^interest:(.*)/);console.log("usersInterests",r);if(r){e.push(r[1])}return e}),[]);return r}function G(e,n){var u=Object.assign(e,{id:e.username,name:e.fullName||e.username,publisher:{name:e.username,username:e.username},hubtype:t.member,summary:e.description||"No profile summary.",description:e.description||"No profile description.",hubType:t.member,url:O+"/home/user.html?user="+e.username,permissions:{visibility:r.public},createdDate:new Date(e.created),createdDateSource:"user.created",updatedDate:new Date(e.modified),updatedDateSource:"user.modified",thumbnailUrl:"",culture:e.culture,region:e.region,metadata:{interests:F(e)}});if(e.thumbnail!==undefined&&e.thumbnail!==null){u.thumbnailUrl=O+"/sharing/rest/community/users/"+e.username+"/info/"+e.thumbnail}return u}var H="https://www.arcgis.com";function J(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:return[4,c(e)];case 1:t=n.sent();r=t.results.reduce((function(e,t){e.push(K(t));return e}),[]);return[2,{results:r,meta:{total:t.total,count:t.num,start:t.start}}]}}))}))}function B(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return[4,h(e)];case 1:t=r.sent();return[2,K(t)]}}))}))}function K(e){var n=Object.assign(e,{id:e.id,name:e.title,hubtype:t.team,publisher:{name:e.owner,username:e.owner},summary:e.snippet||e.description||"No profile summary.",description:e.description||"No profile description.",hubType:t.team,url:H+"/home/group.html?id="+e.id,permissions:{visibility:r[e.access]},createdDate:new Date(e.created),createdDateSource:"group.created",updatedDate:new Date(e.modified),updatedDateSource:"group.modified",thumbnailUrl:"",culture:e.culture,region:e.region});if(e.thumbnail!==undefined&&n.thumbnail!==null){n.thumbnailUrl=H+"/sharing/rest/community/groups/"+e.id+"/info/"+e.thumbnail}return n}}}}));