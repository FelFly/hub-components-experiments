System.register(["./p-efd827df.system.js","./p-adc488b3.system.js","./p-8acf3331.system.js"],(function(e){"use strict";var t,n,r,i,a,o,u,c,f,s,l;return{setters:[function(e){t=e._;n=e.b;r=e.d},function(e){i=e.c},function(e){a=e.c;o=e.b;u=e.a;c=e.d;f=e.e;s=e.f;l=e.h}],execute:function(){e({a:te,s:ne});var p=a.apiTypes.map((function(e){return e.toLowerCase()}));function d(e){if(e===void 0){e={}}var t=(o(e,"counts")||[]).filter((function(e){return e.fieldName==="type"}))[0];if(!t)return{hasApi:{}};return t.fieldValues.reduce((function(e,t){if(p.indexOf(t.value)>-1){e.hasApi.true+=t.count}else{e.hasApi.false+=t.count}return e}),{hasApi:{true:0,false:0}})}function y(e){return e.results.reduce((function(e,t){if((t.typeKeywords||[]).indexOf("Data")>-1||a.downloadableTypes.indexOf(t.type)>-1){e.downloadable.true++}else{e.downloadable.false++}return e}),{downloadable:{true:0,false:0}})}function v(e){if(e===void 0){e={}}var t=(o(e,"counts")||[]).filter((function(e){return e.fieldName==="type"}))[0];if(!t)return{collection:{}};return t.fieldValues.reduce((function(e,t){var n=u(t.value);var r;if(n){r=n.toLowerCase().split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ")}else{r="Other"}e.collection[r]=t.count;return e}),{collection:{}})}function g(e){return Object.keys(e).reduce((function(t,n){t[n]=Object.keys(e[n]).reduce((function(t,r){t.push({key:r,docCount:e[n][r]});return t}),[]).sort(h);return t}),{})}function h(e,t){return t.docCount>e.docCount?1:-1}var m=["tags","type","access","categories"];var b={collection:"type"};function O(e){var t=e.split(",").filter((function(e){return m.indexOf(e)>-1}));var n=e.split(",").filter((function(e){return Object.keys(b).indexOf(e)>-1}));Object.keys(b).forEach((function(e){if(n.indexOf(e)>-1&&!(b[e]in t)){t.push(b[e])}}));return{countFields:t.join(","),countSize:200}}function j(e){if(e===void 0){e=[]}var t=new Set;var n=["","categories"];e.forEach((function(e){var r=e.key.split("/").filter((function(e){return n.indexOf(e)===-1}));r.forEach((function(e){t.add(e)}))}));var r=Array.from(t).reduce((function(t,n){var r=e.filter((function(e){return e.key.includes(n)})).map((function(e){return e.docCount})).reduce((function(e,t){return e+t}));t.push({key:n,docCount:r});return t}),[]);return r}var w=["title","created","type","owner","modified","avgrating","numratings","numcomments","numviews"];var T={name:"title"};function k(e){if(w.indexOf(e)>=0){return e}else if(e in T){return T[e]}}var x={orgId:{type:"filter",dataType:"string",defaultOp:"any",catalogDefinition:true},q:{type:"simple"},page:{type:"simple"},tags:{type:"filter",dataType:"string",defaultOp:"any"},source:{type:"filter",dataType:"string",defaultOp:"any"},bbox:{type:"simple"},location_name:{type:"simple"},sort:{type:"simple"},groupIds:{type:"filter",dataType:"string",defaultOp:"any",catalogDefinition:true},catalog:{type:"simple"},owner:{type:"filter",dataType:"string",defaultOp:"any"},access:{type:"filter",dataType:"string",defaultOp:"any"},type:{type:"filter",dataType:"string",defaultOp:"any"},hubType:{type:"filter",dataType:"string",defaultOp:"any"},downloadable:{type:"filter",dataType:"boolean"},hasApi:{type:"filter",dataType:"boolean"},openData:{type:"filter",dataType:"boolean"},id:{type:"filter",dataType:"string",defaultOp:"any",catalogDefinition:true},collection:{type:"filter",dataType:"string",defaultOp:"any"},sector:{type:"filter",dataType:"string",defaultOp:"any"},region:{type:"filter",dataType:"string",defaultOp:"any"},initiativeId:{type:"filter",dataType:"string",defaultOp:"any",catalogDefinition:true},categories:{type:"filter",dataType:"string",defaultOp:"any"},license:{type:"filter",dataType:"string",defaultOp:"any"},modified:{type:"filter",dataType:"string",defaultOp:"between"}};function D(e){if(!e){return{}}var t=Object.keys(e).reduce((function(t,n){var r=x[n]||{};if(e[n]&&r.type==="filter"&&r.dataType){var i=e[n];t[n]=A(i,r)}return t}),{});return t}function A(e,t){var n=e.match(/(any|all|between)\((.+)\)/);if(n){return{fn:n[1],terms:n[2].split(","),catalogDefinition:t.catalogDefinition}}else{return{fn:t.defaultOp||null,terms:e.split(","),catalogDefinition:t.catalogDefinition}}}function C(e){if(e===void 0){e={}}return Object.keys(e).map((function(t){var n=e[t];var r=n.fn,i=n.terms;var a=n.catalogDefinition?"catalog":"filter";var o=encodeURIComponent(a+"["+t+"]");var u=i.map(encodeURIComponent).join(",");return r?o+"="+r+"("+u+")":o+"="+u})).join("&")}function R(e,t){var n=o(e,t+".terms")||[];var r=o(e,t+".fn");var i;if(r==="between"){var a=n[0];var u=n[1];if(a===u){u=c(a,1)}var f=[a,u].map((function(e){return new Date(e).getTime()}));i=t.toLowerCase()+": ["+f.join(E(r))+"]"}else{i=n.map((function(e){return t.toLowerCase()+':"'+e+'"'})).join(E(r))}if(r==="not"){i="NOT "+i}return"("+i+")"}function E(e){var t=e||"any";var n={any:" OR ",all:" AND ",not:" NOT ",between:" TO "};return n[t]}function S(e){var t=(o(e,"downloadable.terms")||[])[0];var n;var r;if(t==="true"){n=a.downloadableTypes.map((function(e){return'type:"'+e+'"'}));r=a.downloadableTypeKeywords.map((function(e){return'typekeywords:"'+e+'"'}))}else{n=a.downloadableTypes.map((function(e){return'-type:"'+e+'"'}));r=a.downloadableTypeKeywords.map((function(e){return'-typekeywords:"'+e+'"'}))}return"("+n.concat(r).join(" OR ")+")"}function N(e){var t=(o(e,"hasApi.terms")||[])[0];var n;if(t){n=a.apiTypes.map((function(e){return'type:"'+e+'"'})).join(" OR ")}else{n=a.apiTypes.map((function(e){return'-type:"'+e+'"'})).join(" OR ")}return"("+n+")"}function q(e){var t=o(e,"groupIds.terms")||[];var n=t.map((function(e){return'group:"'+e+'"'})).join(" OR ");return"("+n+")"}function z(e){var t=o(e,"collection.terms")||[];var n=t.map((function(e){return f(e)}));var r=n.filter((function(e){return!!e})).reduce((function(e,t){t.forEach((function(t){e.push('type:"'+t+'"')}));return e}),[]).join(" OR ");return"("+r+")"}var F={downloadable:S,hasApi:N,groupIds:q,collection:z};function I(e){return!!F[e]}function U(e){var t=[];var n=[];Object.keys(e).forEach((function(r){var i;if(I(r)){i=F[r](e,r)}else{i=R(e,r)}if(e[r].catalogDefinition){t.push(i)}else{n.push(i)}}));if(t.length){var r="("+t.join(" OR ")+")";if(n.length){return r+" AND ("+n.join(" AND ")+")"}else{return r}}else if(n.length){return n.join(" AND ")}else{return""}}function L(e){if(e===void 0){e={}}var t=K(e);var n=t.filter((function(t){return typeof o(e,t.join("."))!=="object"}));var r=[];n.forEach((function(t){var n="";for(var i=0;i<t.length;i++){if(i===0){n+=t[i]}else{n+="["+t[i]+"]"}}var a=encodeURIComponent(o(e,t.join("."))||"");var u=encodeURIComponent(n);if(a){r.push(u+"="+a)}return n}));var i=r.join("&");return i}function K(e){if(e===void 0){e={}}var t=[];var n=[{obj:e,path:[]}];var r=function(){var e=n.pop();Object.keys(e.obj).forEach((function(r){if(typeof e.obj[r]==="object"){var i=e.path.concat(r);t.push(i);n.unshift({obj:e.obj[r],path:i})}else{t.push(e.path.concat(r))}}))};while(n.length>0){r()}return t}function V(e){if(e===void 0){e={}}var n={q:null,start:o(e,"page.start")||1,num:o(e,"page.size")||10};var r=['-type:"code attachment"'];if(e.restricted){r.push("-access:public")}if(e.q){r.push(e.q)}if(e.catalog){var i=D(e.catalog);r.push(U(i))}var a=D(e);var u=D(e.filter);var c=t(t({},a),u);if(Object.keys(c).length){r.push(U(c))}r=r.filter((function(e){return!!e}));n.q=r.join(" AND ");if(e.bbox){n.bbox=e.bbox}if(e.sort){var f=e.sort[0]==="-"?"desc":"asc";var s=f==="desc"?e.sort.substring(1).split(",")[0]:e.sort.split(",")[0];s=k(s);if(s){n.sortField=s;n.sortOrder=f}}if(e.agg&&e.agg.fields){var l=void 0;if(Array.isArray(e.agg.fields)){l=e.agg.fields.join(",")}else{l=e.agg.fields}var p=O(l),d=p.countFields,y=p.countSize;n.countFields=d;n.countSize=y}return n}var P=3;function _(e,a,u,c){return n(this,void 0,void 0,(function(){var n,f,l,p,d,y,v,g,h;return r(this,(function(r){switch(r.label){case 0:n=V(e);if(!n.countFields)return[3,2];f=s(n.countFields.split(","),P).map((function(e){return e.join(",")}));l=f.map((function(e){return i(t(t({},n),{params:{token:a,countFields:e,countSize:n.countSize},portal:u,authentication:c}))}));return[4,Promise.all(l)];case 1:p=r.sent();d=[];for(y=0,v=p;y<v.length;y++){g=v[y];h=o(g,"aggregations.counts")||[];d=d.concat(h)}p[0].aggregations={counts:d};return[2,p[0]];case 2:return[2,i(t(t({},n),{params:{token:a,countFields:n.countFields,countSize:n.countSize},portal:u,authentication:c}))]}}))}))}var B=["downloadable"];var G=["hasApi","collection"];var H={downloadable:y,hasApi:d,collection:v};function J(e,i,a,u,c){if(e===void 0){e={counts:Array()}}return n(this,void 0,void 0,(function(){var n,f,s,l,p,d,y,v,h;return r(this,(function(r){switch(r.label){case 0:n=o(i,"agg.fields");f=n?n.split(","):[];s=M(f,B);l={};if(!(s.length>0))return[3,2];p=t(t({},i),{start:1,num:100});p.agg={};return[4,_(p,a,u,c)];case 1:d=r.sent();s.forEach((function(e){var n=H[e](d);l=t(t({},l),g(n))}));r.label=2;case 2:y=e.counts.reduce((function(e,t){e[t.fieldName]=t.fieldValues.map((function(e){return{key:e.value,docCount:e.count}}));return e}),{});s=M(f,G);v={};if(s.length>0){s.forEach((function(n){var r=t({},H[n](e));v=t(t({},v),g(r))}))}h=t(t(t({},l),y),v);if(h.categories){h.categories=j(h.categories)}return[2,h]}}))}))}function M(e,t){return e.filter((function(e){return t.indexOf(e)!==-1}))}function Q(e,t,n){if(!e)return undefined;try{var r=e.match(new RegExp(t,"ig"));if(!r)return undefined;return r.reduce(W(n),e)}catch(i){return undefined}}function W(e){return function(t,n){var r='<mark class="hub-search-highlight '+e+'-highlight">'+n+"</mark>";return t.replace(new RegExp(n,"g"),r)}}function X(e,t){var n={id:e.id,type:"item",attributes:Y(e)};if(t){n.meta={};n.meta.highlights=$(e,t)}return n}function Y(e){var n=u(e.type);var r={name:e.title,searchDescription:e.description,hubType:n||"Other",collection:l(e),extent:Z(e.extent)};return t(t({},e),r)}function Z(e){return{coordinates:e,type:"envelope"}}function $(e,t){return{name:Q(e.title,t,"name"),searchDescription:Q(e.description,t,"description")}}function ee(e,n,r){if(n===void 0){n={}}var i=t({},r);return{data:e.results.map((function(e){return X(e,i.q)})),meta:{query:e.query,queryParameters:i,stats:{aggs:n,count:e.results.length,totalCount:e.total},page:{start:e.start,size:e.num,nextStart:e.nextStart}}}}function te(e,t,i,a){return n(this,void 0,void 0,(function(){var n,o,u;return r(this,(function(r){switch(r.label){case 0:return[4,_(e,t,i,a)];case 1:n=r.sent();return[4,J(n.aggregations,e,t,i)];case 2:o=r.sent();u=ee(n,o,e);return[2,u]}}))}))}function ne(e){var t=D(e);var n=C(t);var r=Object.keys(e).filter((function(e){return!re(e)}));var i={};r.forEach((function(t){i[t]=e[t]}));var a=L(i);var o=[];if(a)o.push(a);if(n)o.push(n);return o.join("&")}function re(e){return x[e]&&x[e].type==="filter"}}}}));